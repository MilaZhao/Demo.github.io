<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>åº·å¯¶å»šè—æ™‚ä»£ Knorr Pro v26</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        /* --- 1. Design Tokens --- */
        :root {
            --primary: #00652B; --primary-light: #E6F0EA;
            --secondary: #FF5700; --secondary-light: #FFF0E5;
            --bg-body: #F7F9F8; --surface: #FFFFFF;
            --text-main: #2D3330; --text-body: #4A524F; --text-muted: #8C9692;
            
            --sp-xs: 4px; --sp-sm: 8px; --sp-md: 16px; --sp-lg: 24px;
            --bottom-nav-height: 80px;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 24px rgba(0,101,43,0.08);
            --shadow-up: 0 -4px 12px rgba(0,0,0,0.08);
            --radius-lg: 16px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-body); color: var(--text-main); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding-bottom: var(--bottom-nav-height); line-height: 1.6; }

        /* --- 2. Shared Components --- */
        header { background: var(--surface); position: sticky; top: 0; z-index: 90; box-shadow: var(--shadow-sm); }
        .header-top { background: var(--primary); padding: 8px 16px; height: 56px; display: flex; align-items: center; gap: 16px; color: white; }
        .search-bar { flex: 1; background: rgba(255,255,255,0.15); border-radius: 30px; height: 36px; display: flex; align-items: center; padding: 0 16px; font-size: 14px; }
        .icon-btn { cursor: pointer; color: white; }

        .tab-bar { padding: 12px 0; background: var(--surface); border-bottom: 1px solid #eee; }
        .scrolling-wrapper { display: flex; overflow-x: auto; gap: 8px; padding: 0 16px; scrollbar-width: none; }
        .tab-chip { padding: 6px 16px; border-radius: 20px; font-size: 13px; font-weight: 500; color: var(--text-muted); background: #F5F5F5; white-space: nowrap; transition: 0.2s; cursor: pointer; border: 1px solid transparent; }
        .tab-chip.active { background: var(--primary-light); color: var(--primary); font-weight: 700; border-color: rgba(0,101,43,0.2); }

        .section-header { padding: 24px 16px 12px; display: flex; justify-content: space-between; align-items: center; }
        .section-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .card-scroll-container { display: flex; overflow-x: auto; gap: 16px; padding: 0 16px 16px; scrollbar-width: none; }
        
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 3. Cards & Lists --- */
        .card { background: var(--surface); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; cursor: pointer; position: relative; min-width: 220px; }
        .card:active { transform: scale(0.98); transition: 0.1s; }
        .card-img-wrapper { position: relative; padding-top: 60%; background: #eee; }
        .card-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .card-badge { position: absolute; top: 8px; left: 8px; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); color: white; font-size: 10px; font-weight: 700; padding: 4px 8px; border-radius: 4px; }
        .card-content { padding: 12px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-weight: 700; font-size: 15px; margin-bottom: 8px; line-height: 1.3; }
        .card-meta { display: flex; gap: 4px; flex-wrap: wrap; margin-top: auto; }
        .meta-tag { font-size: 10px; background: #F0F2F1; padding: 2px 6px; border-radius: 4px; color: #666; display: flex; align-items: center; gap: 2px; }

        .list-card { background: var(--surface); margin: 0 16px 12px; padding: 16px; border-radius: 12px; box-shadow: var(--shadow-sm); display: flex; gap: 16px; align-items: flex-start; cursor: pointer; position: relative; }
        .list-card-img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .rank-badge { position: absolute; top: 0; left: 0; width: 24px; height: 24px; border-radius: 12px 0 12px 0; display: flex; justify-content: center; align-items: center; font-weight: 900; font-size: 12px; color: #fff; z-index: 2; }
        .rank-1 { background: #FFD700; color: #333; }
        .rank-2 { background: #C0C0C0; color: #333; }
        .rank-3 { background: #CD7F32; }
        
        .ranking-tabs { display: flex; border-bottom: 1px solid #eee; margin-bottom: 12px; }
        .ranking-tab { flex: 1; text-align: center; padding: 12px; font-size: 14px; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; }
        .ranking-tab.active { color: var(--primary); font-weight: 700; border-color: var(--primary); }

        /* --- 4. Recipe Page Styles --- */
        .chef-banner { margin: 16px; background: linear-gradient(135deg, #1a1a1a, #333); border-radius: 16px; padding: 20px; color: white; display: flex; align-items: center; justify-content: space-between; overflow: hidden; position: relative; box-shadow: var(--shadow-md); cursor: pointer; }
        .chef-banner::after { content:''; position:absolute; right:-20px; top:-20px; width:100px; height:100px; background:var(--secondary); border-radius:50%; opacity:0.15; }
        
        .strategy-cta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 16px 8px; margin-bottom: 8px; }
        .strategy-btn { background: var(--surface); border-radius: 16px; padding: 16px; display: flex; flex-direction: column; align-items: center; gap: 8px; box-shadow: var(--shadow-sm); cursor: pointer; border: 1px solid #f0f0f0; transition:0.1s;}
        .strategy-btn:active { transform: scale(0.98); background: #fafafa; }
        .btn-icon-circle { width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; margin-bottom: 4px; }
        .btn-change .btn-icon-circle { background: #E3F2FD; color: #1565C0; }
        .btn-fast .btn-icon-circle { background: #FFF3E0; color: #E65100; }
        .recipe-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; padding: 0 16px 24px; }

        /* --- 5. Scan & Profile Page --- */
        .scan-container { height: calc(100vh - 80px); background: #121212; display: flex; flex-direction: column; position: relative; }
        .scan-viewfinder { flex: 1; display: flex; justify-content: center; align-items: center; position: relative; }
        .scan-frame { width: 260px; height: 260px; border: 2px solid var(--secondary); border-radius: 24px; position: relative; box-shadow: 0 0 0 4000px rgba(0,0,0,0.7); }
        .scan-frame::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: var(--secondary); box-shadow: 0 0 10px var(--secondary); animation: scanMove 2s infinite linear; }
        @keyframes scanMove { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }
        .scan-controls { position: absolute; top: 20px; right: 20px; z-index: 10; }
        .toggle-btn { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 8px 16px; border-radius: 20px; color: white; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .toggle-switch { width: 32px; height: 18px; background: rgba(0,0,0,0.3); border-radius: 10px; position: relative; transition: 0.3s; border:1px solid rgba(255,255,255,0.5); }
        .toggle-switch.on { background: var(--secondary); border-color:var(--secondary); }
        .toggle-switch::after { content:''; position: absolute; top: 2px; left: 2px; width: 12px; height: 12px; background: white; border-radius: 50%; transition: 0.3s; }
        .toggle-switch.on::after { transform: translateX(14px); }
        .rewards-panel { background: white; border-radius: 24px 24px 0 0; padding: 24px 20px; z-index: 10; }
        .progress-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; }
        .progress-track { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; margin-bottom: 20px; margin-top: 8px; }
        .progress-fill { width: 85%; height: 100%; background: linear-gradient(90deg, var(--primary), #4CAF50); border-radius: 4px; }
        .instant-rewards { display: flex; gap: 12px; }
        .reward-card { flex: 1; border: 1px solid #eee; padding: 12px; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.2s; }
        .reward-card:active { border-color: var(--primary); background: var(--primary-light); }
        .toast { position: absolute; bottom: 200px; left: 50%; transform: translateX(-50%); background: rgba(0, 101, 43, 0.95); color: white; padding: 12px 24px; border-radius: 30px; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px; opacity: 0; transition: 0.3s; pointer-events: none; z-index: 20; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }

        /* Profile Styles */
        .profile-header { background: var(--primary); padding: 32px 20px 60px; color: white; border-radius: 0 0 24px 24px; position: relative; }
        .profile-user { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }
        .profile-avatar { width: 64px; height: 64px; background: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 28px; font-weight: 700; color: var(--primary); border: 3px solid rgba(255,255,255,0.3); }
        .profile-card { background: white; border-radius: 16px; padding: 20px; margin: -40px 16px 16px; box-shadow: var(--shadow-md); }
        .barcode-area { text-align: center; padding: 16px 0; border-bottom: 1px dashed #eee; margin-bottom: 16px; }
        .barcode-img { height: 60px; opacity: 0.8; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .menu-btn { background: #f9f9f9; padding: 16px; border-radius: 12px; text-align: center; cursor: pointer; }
        .menu-btn-icon { font-size: 28px; margin-bottom: 8px; color: var(--primary); }
        .support-btn { background: #E3F2FD; color: #1565C0; padding: 16px; border-radius: 12px; display: flex; justify-content: center; align-items: center; gap: 8px; margin: 0 16px; cursor: pointer; font-weight: 700; }

        /* --- 6. Wizard Modal --- */
        #wizard-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; justify-content: center; align-items: flex-end; backdrop-filter: blur(4px); }
        .wizard-container { background: var(--surface); width: 100%; border-radius: 24px 24px 0 0; padding: 32px 24px; max-height: 90vh; overflow-y: auto; position: relative; animation: slideUp 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .wizard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .wizard-progress { display: flex; gap: 6px; margin-bottom: 24px; }
        .progress-bar { height: 6px; flex: 1; background: #f0f0f0; border-radius: 3px; transition: 0.3s; }
        .progress-bar.active { background: var(--secondary); }
        .wizard-option-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .wizard-option { padding: 20px; border: 2px solid #f0f0f0; border-radius: 16px; text-align: center; font-weight: 700; color: var(--text-body); cursor: pointer; transition: 0.2s; background: #fff; font-size: 16px; }
        .wizard-option:active { border-color: var(--primary); background: var(--primary-light); color: var(--primary); transform: scale(0.98); }
        .result-context { background: var(--primary-light); padding: 20px; margin: 16px; border-radius: 16px; display: flex; flex-direction: column; gap: 12px; border: 1px solid rgba(0,101,43,0.1); }
        .result-chips { display: flex; flex-wrap: wrap; gap: 8px; }
        .result-chip { background: white; color: var(--text-body); padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; border: 1px solid rgba(0,0,0,0.05); }

        /* --- 7. Detail View (Enhanced) --- */
        #detail-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--surface); z-index: 3000; overflow-y: auto; display: none; }
        .detail-hero { height: 320px; position: relative; }
        .detail-hero img { width: 100%; height: 100%; object-fit: cover; }
        .detail-back { position: fixed; top: 24px; left: 20px; width: 44px; height: 44px; background: rgba(255,255,255,0.95); border-radius: 50%; display: flex; justify-content: center; align-items: center; z-index: 3010; cursor: pointer; box-shadow: var(--shadow-md); }
        
        .detail-body { padding: 32px 24px; background: white; border-radius: 32px 32px 0 0; margin-top: -40px; position: relative; min-height: 80vh; padding-bottom: 120px; }
        
        .progress-bar-top { position: fixed; top: 0; left: 0; width: 100%; height: 6px; background: #eee; z-index: 3020; display:none; }
        .progress-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.1s; }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 24px; }
        .info-box { background: #FAFAFA; border: 1px solid #EEE; border-radius: 16px; padding: 16px 12px; text-align: center; }
        .info-label { font-size: 12px; color: #888; margin-bottom: 4px; }
        .info-value { font-weight: 700; color: #333; }

        .section-header-detail { font-size: 18px; font-weight: 700; color: var(--text-main); margin: 32px 0 16px; display: flex; align-items: center; gap: 8px; padding-left: 12px; border-left: 4px solid var(--secondary); }
        
        /* Updated Ingredients & Checkbox */
        .checkbox-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f9f9f9; cursor: pointer; }
        .checkbox-left { display: flex; align-items: center; gap: 12px; }
        .checkbox-circle { width: 22px; height: 22px; border: 2px solid #ddd; border-radius: 50%; transition: 0.2s; position: relative; flex-shrink: 0; }
        .checkbox-circle.checked { background: var(--primary); border-color: var(--primary); }
        .checkbox-circle.checked::after { content:'âœ“'; color:white; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:12px; }
        .ing-amount { font-weight: 700; color: var(--text-body); transition: color 0.3s; }
        .ing-amount.changed { color: var(--secondary); animation: pulse 0.5s; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* New: Tags */
        .tag-row { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
        .detail-tag { font-size: 12px; color: var(--primary); background: var(--primary-light); padding: 4px 12px; border-radius: 20px; font-weight: 600; }

        /* New: Portion Scaler */
        .portion-control { display: flex; align-items: center; justify-content: space-between; background: #F5F5F5; border-radius: 12px; padding: 8px 16px; margin-bottom: 24px; }
        .portion-btn { width: 32px; height: 32px; background: white; border-radius: 50%; border: 1px solid #ddd; display: flex; justify-content: center; align-items: center; cursor: pointer; color: var(--primary); font-weight: bold; user-select: none; }
        .portion-btn:active { background: var(--primary-light); }
        .portion-display { font-weight: 700; font-size: 16px; display: flex; flex-direction: column; align-items: center; line-height: 1.2; }
        .portion-label { font-size: 10px; color: #888; }
        
        /* Multi-Use Card Style Update */
        .rp-card { min-width: 130px; border: 1px solid #eee; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer; transition: 0.2s; background: white; }
        .rp-card:active { border-color: var(--primary); transform: scale(0.98); background: #FAFAFA; }
        .rp-img { width: 100%; height: 80px; object-fit: cover; border-radius: 8px; margin-bottom: 8px; }

        /* New: Fixed Footer CTA */
        .detail-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: white; box-shadow: var(--shadow-up); padding: 16px 24px; display: flex; gap: 12px; z-index: 3020; padding-bottom: max(16px, env(safe-area-inset-bottom)); }
        .btn-outline { flex: 1; border: 1px solid var(--primary); color: var(--primary); background: white; border-radius: 30px; height: 48px; font-weight: 700; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn-primary { flex: 1; background: var(--primary); color: white; border: none; border-radius: 30px; height: 48px; font-weight: 700; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(0,101,43,0.3); }

        /* Comments New Style */
        .comment-section { margin-top: 40px; border-top: 1px solid #eee; padding-top: 24px; }
        .comment-item { display: flex; gap: 16px; margin-bottom: 24px; border-bottom: 1px solid #f5f5f5; padding-bottom: 16px; }
        .comment-avatar { width: 40px; height: 40px; background: #81C784; color:white; border-radius: 50%; display:flex; justify-content:center; align-items:center; font-weight:700; flex-shrink:0; }
        .comment-body { flex: 1; }
        .comment-name { font-weight: 700; font-size: 14px; margin-bottom: 2px; }
        .comment-meta { font-size: 12px; color: #777; display: flex; gap: 8px; margin-bottom: 8px; }
        .comment-stars { color: #FBC02D; letter-spacing: 1px; }
        .comment-text { font-size: 14px; color: #444; line-height: 1.5; }
        .comment-actions { margin-top: 12px; display: flex; gap: 12px; }
        .action-chip { font-size: 12px; color: #555; border: 1px solid #ddd; padding: 4px 12px; border-radius: 16px; display: flex; align-items: center; gap: 4px; cursor: pointer; transition: 0.2s; }
        .action-chip:active { background: #f0f0f0; }

        .comment-input-area { background: #F5F5F5; padding: 4px 4px 4px 16px; border-radius: 24px; display: flex; align-items: center; margin-top: 16px; border: 1px solid transparent; transition: 0.2s; }
        .comment-input-area:focus-within { border-color: var(--primary); background: white; box-shadow: 0 0 0 4px rgba(0,101,43,0.1); }
        .btn-submit { background: var(--primary); color: white; border: none; width: 36px; height: 36px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; margin-left: 8px; flex-shrink: 0; }
        .btn-submit.editing { background: var(--secondary); }

        /* Product Recommendation */
        .product-rec-container { padding: 16px 0 32px; }
        .product-card-sm { background: #F9F9F9; border-radius: 12px; padding: 12px; display: flex; align-items: center; gap: 12px; border: 1px solid #EEE; margin-bottom: 12px; cursor: pointer; }
        .product-card-sm img { width: 48px; height: 48px; object-fit: contain; }

        /* Nav (Updated to remove floating circle) */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: var(--bottom-nav-height); background: rgba(255,255,255,0.98); backdrop-filter: blur(20px); border-top: 1px solid #eee; display: flex; justify-content: space-around; padding-top: 12px; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 6px; color: var(--text-muted); cursor: pointer; flex: 1; transition: 0.2s; }
        .nav-item.active { color: var(--primary); }
        .nav-icon-container { width: 24px; height: 24px; display: flex; justify-content: center; align-items: center; }
        /* Points Circle Style */
        .scan-circle-icon { width: 32px; height: 32px; background: var(--primary); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 8px rgba(0,101,43,0.3); }

    </style>
</head>
<body>

    <div id="app-root"></div>

    <div id="wizard-overlay">
        <div class="wizard-container">
            <div class="wizard-header">
                <span class="wizard-title" id="wizard-title" style="font-size:20px;font-weight:700;"></span>
                <span class="material-symbols-outlined" onclick="closeWizard()" style="cursor:pointer;padding:8px;">close</span>
            </div>
            <div class="wizard-progress" id="wizard-progress" style="display:flex;gap:6px;margin-bottom:24px;"></div>
            <div id="wizard-content"></div>
            <div id="wizard-loading" style="display:none; text-align:center; padding:60px 0;">
                <span class="material-symbols-outlined" style="font-size:56px; color:var(--secondary); animation:spin 1s linear infinite;">progress_activity</span>
                <p style="font-weight:700; color:var(--primary); margin-top:24px; font-size:18px;">æ­£åœ¨æ¨è–¦æœ€ä½³æ–¹æ¡ˆ</p>
                <style>@keyframes spin { 100% { transform: rotate(360deg); } }</style>
            </div>
        </div>
    </div>

    <div id="detail-view" onscroll="updateProgress()">
        <div class="progress-bar-top"><div class="progress-bar-fill" id="read-progress"></div></div>
        <div class="detail-back" onclick="closeDetail()"><span class="material-symbols-outlined">arrow_back</span></div>
        <div class="detail-hero"><img id="detail-img" src=""></div>
        <div class="detail-body" id="detail-content"></div>
        <div id="detail-footer-slot"></div> 
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="router('home')"><span class="material-symbols-outlined">home</span><span style="font-size:10px;">é¦–é </span></div>
        <div class="nav-item" onclick="router('info')"><span class="material-symbols-outlined">article</span><span style="font-size:10px;">é¤é£²æƒ…å ±</span></div>
        <div class="nav-item" onclick="router('scan')">
            <div class="scan-circle-icon"><span class="material-symbols-outlined" style="font-size:20px;">qr_code_scanner</span></div>
            <span style="font-size:10px;font-weight:700;color:var(--primary);margin-top:2px;">é›†é»</span>
        </div>
        <div class="nav-item" onclick="router('recipes')"><span class="material-symbols-outlined">menu_book</span><span style="font-size:10px;">å°ˆæ¥­é£Ÿè­œ</span></div>
        <div class="nav-item" onclick="router('shop')"><span class="material-symbols-outlined">shopping_cart</span><span style="font-size:10px;">è³¼è²·</span></div>
    </nav>

    <script>
        // --- Data ---
        const db = {
            recipes: [
                { id: 1, title: "éº»è¾£æ°´ç…®é­š", category: ["all","chef","spicy"], tags: ["#å·èœç¶“å…¸", "#å†¬å­£é™å®š", "#é«˜åˆ©æ½¤"], type: "åå»š", date: "1æœˆ12æ—¥", img: "https://www.unileverfoodsolutions.tw/dam/global-ufs/mcos/na/taiwan/calcmenu/recipes/TW-recipes/general/%E9%BA%BB%E8%BE%A3%E6%B0%B4%E7%85%AE%E9%AD%9A/CR2024Traditional003%20(2).jpg", 
                  stats: {time: "15åˆ†", cost: "$45", diff: "ä¸­"}, ranking: 1, reviews: 24, baseServings: 10,
                  desc: "æ±ŸæŒ¯èª ä¸»å»šæ¨è–¦æŠ€æ³•ï¼Œé€éä½æº«æ…¢ç…®é–ä½è‚‰æ±ï¼Œæ­é…åº·å¯¶éº»è¾£é†¬èˆ‡ç‰¹è£½èŠ±æ¤’æ²¹ï¼Œå‘ˆç¾å¤šå±¤æ¬¡é¦™æ°£ã€‚",
                  ingredients: [ {name: "é±¸é­šç‰‡", amount: 400, unit: "g"}, {name: "è±†èŠ½èœ", amount: 200, unit: "g"}, {name: "åº·å¯¶éº»è¾£é†¬", amount: 3, unit: "å¤§åŒ™"}, {name: "åº·å¯¶é›ç²‰", amount: 1, unit: "å°åŒ™"}, {name: "èŠ±æ¤’ç²’", amount: 1, unit: "å¤§åŒ™"} ],
                  steps: [{t:"é†ƒè£½",c:"é±¸é­šç‰‡åˆ‡è–„ç‰‡ï¼Œç”¨é¹½ã€å¤ªç™½ç²‰é†ƒè£½10åˆ†é˜ã€‚"}, {t:"ç‚’é†¬ç…®æ¹¯",c:"èµ·æ²¹é‹çˆ†é¦™éº»è¾£é†¬ï¼ŒåŠ å…¥é«˜æ¹¯ç…®æ»¾ã€‚"}, {t:"æ·‹æ²¹çˆ†é¦™",c:"é­šç‰‡ç…®ç†Ÿç››ç›¤ã€‚å¦èµ·æ²¹é‹çˆ†é¦™èŠ±æ¤’ã€ä¹¾è¾£æ¤’ï¼Œæ·‹åœ¨é­šç‰‡ä¸Šã€‚"}],
                  tips: "å¤ªç™½ç²‰èƒ½è®“é­šè‚‰æ›´æ»‘å«©ï¼Œé†ƒè£½æ™‚åŠ ä¸€é»è›‹ç™½æ•ˆæœæ›´å¥½ã€‚", qa: [{q:"ä¸åƒè¾£?",a:"æ”¹ç•ªèŒ„æ¹¯åº•ã€‚"}], 
                  multiUse: [{id: 101, name:"éº»è¾£é‹",cost:"$30", img: "https://placehold.co/150x100/e74c3c/fff?text=Pot"},{id: 102, name:"å£æ°´é›",cost:"$50", img: "https://placehold.co/150x100/d35400/fff?text=Chicken"}],
                  comments: [{id:1, user:"ç‹å¤§å»š", star:5, date:"2å¤©å‰", text:"å®¢äººåæ‡‰å¾ˆå¥½ï¼Œå‡ºé¤å¾ˆå¿«ï¼"}, {id:2, user:"æåº—é•·", star:4, date:"1é€±å‰", text:"æˆæœ¬æ§åˆ¶å¾—å®œã€‚"}]
                },
                { id: 2, title: "æ³°å¼æ‰“æ‹‹è±¬", category: ["all","lazy","low_cost"], tags: ["#ç•°åœ‹æ–™ç†", "#ä¸‹é£¯ç¥å™¨"], type: "æ‡¶äººåŒ…", date: "1æœˆ10æ—¥", img: "./img/thai_pork.png",
                  stats: {time: "10åˆ†", cost: "$38", diff: "æ˜“"}, ranking: 2, reviews: 56, baseServings: 5,
                  desc: "ä¸€é†¬æå®šè¤‡é›œèª¿å‘³ï¼Œé©åˆå•†æ¥­åˆé¤ã€‚",
                  ingredients: [ {name: "è±¬çµè‚‰", amount: 150, unit: "g"}, {name: "ä¹å±¤å¡”", amount: 1, unit: "æŠŠ"}, {name: "åº·å¯¶æ³°å¼æ‰“æ‹‹é†¬", amount: 2, unit: "å¤§åŒ™"}, {name: "é­šéœ²", amount: 1, unit: "å°åŒ™"}],
                  steps: [{t:"ç‚’çµè‚‰",c:"ç†±é‹çˆ†é¦™è’œæœ«ï¼ŒåŠ å…¥è±¬çµè‚‰ç‚’è‡³è®Šè‰²ã€‚"}, {t:"åŠ é†¬æ‹Œç‚’",c:"åŠ å…¥æ‰“æ‹‹é†¬æ‹Œå‹»ï¼Œèµ·é‹å‰æ”¾ä¹å±¤å¡”ã€‚"}],
                  tips: "å¤§ç«å¿«ç‚’æ‰æœ‰é‘Šæ°£ï¼Œçµè‚‰æ‰ä¸æœƒå‡ºæ°´ã€‚", qa: [{q:"ç”¨é›è‚‰?",a:"å¯ä»¥ã€‚"}],
                  multiUse: [{id: 103, name:"ç‚’æ²³ç²‰",cost:"$32", img:"https://placehold.co/150x100/2ecc71/fff?text=Noodle"}, {id: 104, name:"æ¶¼æ‹Œæµ·é®®",cost:"$45", img:"https://placehold.co/150x100/3498db/fff?text=Seafood"}], 
                  comments: [{id:3, user:"é™³å¸«å‚…", star:5, date:"3å¤©å‰", text:"çœŸçš„åªè¦ä¸€ç½é†¬ã€‚"}]
                },
                // --- Dummy Recipes Populated with Detail ---
                { id: 3, title: "å£æ°´é›", category: ["chef"], type: "åå»š", date: "1æœˆ09æ—¥", img: "https://www.unileverfoodsolutions.tw/dam/global-ufs/mcos/na/taiwan/calcmenu/recipes/TW-recipes/general/%E5%8F%A3%E6%B0%B4%E9%9B%9E/main-header.jpg", stats: {time: "20åˆ†", cost: "$60", diff: "ä¸­"}, ranking: 3, desc: "é®®é¦™éº»è¾£ã€‚", 
                  ingredients: [{name:"é›è…¿è‚‰",amount:2,unit:"æ”¯"},{name:"èŠ±ç”Ÿ",amount:50,unit:"g"},{name:"èŠ±æ¤’æ²¹",amount:2,unit:"å¤§åŒ™"}], 
                  steps: [{t:"ç…®é›",c:"é›è‚‰ç…®ç†Ÿå¾Œå†°é®åˆ‡å¡Šã€‚"},{t:"èª¿é†¬",c:"æ··åˆèª¿å‘³æ–™æ·‹åœ¨é›è‚‰ä¸Šã€‚"}], tips: "å†°é®æ˜¯çš®è„†è‚‰å«©çš„é—œéµã€‚", multiUse: [], comments: [] },
                { id: 4, title: "èˆ’è‚¥æ³¢ç‰¹é…’é¢¨å‘³é´¨èƒ¸ä¹³é…ªç‡‰é£¯", category: ["chef"], type: "åå»š", date: "1æœˆ08æ—¥", img: "https://www.unileverfoodsolutions.tw/dam/global-ufs/mcos/na/taiwan/calcmenu/recipes/TW-recipes/general/%E8%88%92%E8%82%A5%E6%B3%A2%E7%89%B9%E9%85%92%E9%A2%A8%E5%91%B3%E9%B4%A8%E8%83%B8%E4%B9%B3%E9%85%AA%E7%87%89%E9%A3%AF/main-header.jpg", stats: {time: "25åˆ†", cost: "$80", diff: "é›£"}, ranking: 4, desc: "æ¿ƒéƒæ¾éœ²é¦™ã€‚", 
                  ingredients: [{name:"ç¾©å¤§åˆ©ç±³",amount:200,unit:"g"},{name:"ç¶œåˆé‡è‡",amount:100,unit:"g"},{name:"æ¾éœ²é†¬",amount:1,unit:"å¤§åŒ™"}], 
                  steps: [{t:"ç‚’è‡",c:"é‡è‡ç‚’é¦™å‚™ç”¨ã€‚"},{t:"ç‡‰é£¯",c:"ç±³ç‚’é¦™å¾Œåˆ†æ¬¡åŠ å…¥é«˜æ¹¯ç‡‰ç…®ã€‚"}], tips: "é«˜æ¹¯è¦åˆ†æ¬¡åŠ æ‰èƒ½ç…®å‡ºæ¿ƒç¨ æ„Ÿã€‚", multiUse: [], comments: [] },
                { id: 5, title: "æ³•å¼æ´‹è”¥æ¹¯", category: ["chef"], type: "åå»š", date: "1æœˆ07æ—¥", img: "https://www.unileverfoodsolutions.tw/dam/global-ufs/mcos/na/taiwan/calcmenu/recipes/TW-recipes/general/%E6%B4%8B%E8%94%A5%E6%B9%AF/CR2024Beef002.jpg", stats: {time: "40åˆ†", cost: "$30", diff: "ä¸­"}, ranking: 5, desc: "ç¶“å…¸æ¹¯å“ã€‚", 
                  ingredients: [{name:"æ´‹è”¥",amount:3,unit:"é¡†"},{name:"ç‰›é«˜æ¹¯",amount:500,unit:"ml"},{name:"èµ·å¸",amount:50,unit:"g"}], 
                  steps: [{t:"ç‚’æ´‹è”¥",c:"å°ç«æ…¢ç‚’æ´‹è”¥è‡³ç„¦ç³–è‰²ã€‚"},{t:"ç…®æ¹¯",c:"åŠ å…¥é«˜æ¹¯ç…®æ»¾å¾Œç„—çƒ¤ã€‚"}], tips: "æ´‹è”¥ç‚’å¾—è¶Šä¹…è¶Šç”œã€‚", multiUse: [], comments: [] },
                { id: 6, title: "é¿é¢¨å¡˜ç‚’èŸ¹", category: ["chef"], type: "åå»š", date: "1æœˆ06æ—¥", img: "https://placehold.co/800x600/e67e22/fff?text=Crab", stats: {time: "30åˆ†", cost: "$120", diff: "é›£"}, ranking: 6, desc: "é¦™é…¥å¯å£ã€‚", 
                  ingredients: [{name:"èƒèŸ¹",amount:2,unit:"éš»"},{name:"è’œé…¥",amount:100,unit:"g"},{name:"ä¹¾è¾£æ¤’",amount:10,unit:"g"}], 
                  steps: [{t:"ç‚¸èŸ¹",c:"èƒèŸ¹åˆ‡å¡Šç‚¸é…¥ã€‚"},{t:"æ‹Œç‚’",c:"çˆ†é¦™æ–™å¾ŒåŠ å…¥èƒèŸ¹æ‹Œç‚’ã€‚"}], tips: "è’œé…¥è¦æ§åˆ¶ç«å€™é¿å…åè‹¦ã€‚", multiUse: [], comments: [] },
                { id: 7, title: "æ¸…è’¸çŸ³æ–‘", category: ["chef"], type: "åå»š", date: "1æœˆ05æ—¥", img: "https://placehold.co/800x600/3498db/fff?text=Fish", stats: {time: "15åˆ†", cost: "$150", diff: "æ˜“"}, ranking: 7, desc: "é®®ç”œåŸå‘³ã€‚", 
                  ingredients: [{name:"çŸ³æ–‘é­š",amount:1,unit:"å°¾"},{name:"è”¥è–‘çµ²",amount:30,unit:"g"},{name:"è’¸é­šé†¬æ²¹",amount:2,unit:"å¤§åŒ™"}], 
                  steps: [{t:"è’¸é­š",c:"å¤§ç«è’¸8åˆ†é˜ã€‚"},{t:"æ·‹æ²¹",c:"é‹ªä¸Šè”¥çµ²æ·‹ä¸Šç†±æ²¹ã€‚"}], tips: "æ°´æ»¾å¾Œå†æ”¾é­šã€‚", multiUse: [], comments: [] },
                { id: 8, title: "ç´…é…’ç‡‰ç‰›è‚‰", category: ["chef"], type: "åå»š", date: "1æœˆ04æ—¥", img: "https://placehold.co/800x600/8e44ad/fff?text=Beef", stats: {time: "90åˆ†", cost: "$100", diff: "é›£"}, ranking: 8, desc: "å…¥å£å³åŒ–ã€‚", 
                  ingredients: [{name:"ç‰›è‚‹æ¢",amount:600,unit:"g"},{name:"ç´…é…’",amount:300,unit:"ml"},{name:"ç´…è˜¿è””",amount:1,unit:"æ ¹"}], 
                  steps: [{t:"ç…è‚‰",c:"ç‰›è‚‰ç…è‡³è¡¨é¢é‡‘é»ƒã€‚"},{t:"ç‡‰ç…®",c:"åŠ å…¥è”¬èœèˆ‡ç´…é…’ç‡‰ç…®1.5å°æ™‚ã€‚"}], tips: "éš”å¤œåŠ ç†±æ›´å¥½åƒã€‚", multiUse: [], comments: [] },
                { id: 9, title: "XOé†¬ç‚’é›™è„†", category: ["chef"], type: "åå»š", date: "1æœˆ03æ—¥", img: "https://placehold.co/800x600/27ae60/fff?text=XO", stats: {time: "10åˆ†", cost: "$70", diff: "ä¸­"}, ranking: 9, desc: "é‘Šæ°£åè¶³ã€‚", 
                  ingredients: [{name:"è¦ä»",amount:100,unit:"g"},{name:"èŠ±æ",amount:100,unit:"g"},{name:"XOé†¬",amount:2,unit:"å¤§åŒ™"}], 
                  steps: [{t:"éæ²¹",c:"æµ·é®®å¿«é€Ÿéæ²¹ã€‚"},{t:"å¿«ç‚’",c:"å¤§ç«å¿«ç‚’åŠ å…¥XOé†¬ã€‚"}], tips: "ç«å€™è¦å¤§ï¼Œå‹•ä½œè¦å¿«ã€‚", multiUse: [], comments: [] },
                { id: 10, title: "é‡‘æ²™ä¸­å·", category: ["chef"], type: "åå»š", date: "1æœˆ02æ—¥", img: "https://placehold.co/800x600/f1c40f/333?text=Squid", stats: {time: "15åˆ†", cost: "$65", diff: "ä¸­"}, ranking: 10, desc: "é¹¹è›‹é»ƒé¦™æ°£ã€‚", 
                  ingredients: [{name:"ä¸­å·",amount:2,unit:"éš»"},{name:"é¹¹è›‹é»ƒ",amount:3,unit:"é¡†"},{name:"è”¥èŠ±",amount:10,unit:"g"}], 
                  steps: [{t:"ç‚¸ä¸­å·",c:"ä¸­å·è£¹ç²‰ç‚¸é…¥ã€‚"},{t:"ç‚’é‡‘æ²™",c:"é¹¹è›‹é»ƒç‚’è‡³èµ·æ³¡å¾Œè£¹ä¸Šä¸­å·ã€‚"}], tips: "é¹¹è›‹é»ƒè¦ç‚’åˆ°èµ·æ³¡æ‰é¦™ã€‚", multiUse: [], comments: [] },
                // Dummy IDs for Multi-Use Linking
                { id: 101, title: "éº»è¾£é‹åº•", category: ["all"], type: "å»¶ä¼¸", date: "", img: "https://placehold.co/800x600/e74c3c/fff?text=Pot", stats: {time: "5åˆ†", cost: "$30", diff: "æ˜“"}, desc: "ä¸€é†¬æˆæ¹¯ã€‚", 
                  ingredients: [{name:"é«˜æ¹¯",amount:1000,unit:"ml"},{name:"éº»è¾£é†¬",amount:3,unit:"å¤§åŒ™"}], steps: [{t:"ç…®æ¹¯",c:"æ··åˆç…®æ»¾å³å¯ã€‚"}], tips: "", multiUse: [], comments: [] },
                { id: 102, title: "å£æ°´é›", category: ["all"], type: "å»¶ä¼¸", date: "", img: "https://placehold.co/800x600/d35400/fff?text=Chicken", stats: {time: "15åˆ†", cost: "$50", diff: "ä¸­"}, desc: "å†·ç›¤é¦–é¸ã€‚", 
                  ingredients: [{name:"é›è‚‰",amount:1,unit:"ä»½"},{name:"éº»è¾£é†¬",amount:1,unit:"åŒ™"}], steps: [{t:"æ·‹é†¬",c:"é†¬æ–™æ·‹åœ¨é›è‚‰ä¸Šã€‚"}], tips: "", multiUse: [], comments: [] },
                { id: 103, title: "ç‚’æ²³ç²‰", category: ["all"], type: "å»¶ä¼¸", date: "", img: "https://placehold.co/800x600/2ecc71/fff?text=Noodle", stats: {time: "8åˆ†", cost: "$32", diff: "æ˜“"}, desc: "Qå½ˆå¥½åƒã€‚", 
                  ingredients: [{name:"æ²³ç²‰",amount:200,unit:"g"},{name:"æ‰“æ‹‹é†¬",amount:1,unit:"åŒ™"}], steps: [{t:"å¿«ç‚’",c:"å¤§ç«ç‚’å‹»ã€‚"}], tips: "", multiUse: [], comments: [] },
                { id: 104, title: "æ¶¼æ‹Œæµ·é®®", category: ["all"], type: "å»¶ä¼¸", date: "", img: "https://placehold.co/800x600/3498db/fff?text=Seafood", stats: {time: "10åˆ†", cost: "$45", diff: "æ˜“"}, desc: "é…¸è¾£é–‹èƒƒã€‚", 
                  ingredients: [{name:"æµ·é®®",amount:100,unit:"g"},{name:"æ‰“æ‹‹é†¬",amount:1,unit:"åŒ™"}], steps: [{t:"æ‹Œå‹»",c:"æ‰€æœ‰ææ–™æ‹Œå‹»ã€‚"}], tips: "", multiUse: [], comments: [] },
            ],
            info: [
                { id: 101, title: "éŸ“å¼ç™¼é…µé†¬æ‡‰ç”¨è¶¨å‹¢", category: "trend", date: "1æœˆ11æ—¥", isNew: true, img: "https://placehold.co/800x600/eee/333?text=Korean+Sauce",
                  views: "1.2k", ranking: 1, tldr: ["å¯å–ä»£å‚³çµ±é†ƒæ–™","æˆæœ¬é™ä½30%"], 
                  content: `<p>è¿‘å¹´éŸ“å¼æ–™ç†é¢¨æ½®å¸­æ²å…¨çƒï¼Œç™¼é…µé†¬æ–™çš„ç¨ç‰¹é¢¨å‘³æˆç‚ºé¤é£²æ¥­çš„æ–°å¯µã€‚æ ¹æ“š 2024 é¤é£²è¶¨å‹¢å ±å‘Šï¼Œä½¿ç”¨ç™¼é…µèª¿å‘³å“çš„é¤å»³æ¯”å‚³çµ±é¤å»³å¤šå‡º 35% çš„å›å®¢ç‡ã€‚</p>
                            <img src="https://placehold.co/800x400/eee/333?text=Trend+Chart" style="width:100%;border-radius:8px;margin:16px 0;">
                            <h3>ç‚ºä»€éº¼é¸æ“‡ç™¼é…µé†¬ï¼Ÿ</h3>
                            <p>éŸ“å¼ç™¼é…µé†¬çš„ç¨ç‰¹ä¹‹è™•åœ¨æ–¼å…¶æ·±å±¤çš„é®®å‘³ï¼ˆUmamiï¼‰ï¼Œèƒ½ç‚ºæ–™ç†å¸¶ä¾†è±å¯Œçš„å±¤æ¬¡æ„Ÿã€‚ä¸åƒ…å¯ä»¥ç”¨æ–¼å‚³çµ±éŸ“å¼æ–™ç†ï¼Œå¦‚éƒ¨éšŠé‹ã€çŸ³é‹æ‹Œé£¯ï¼Œæ›´èƒ½èˆ‡è¥¿å¼æ–™ç†çµåˆï¼Œä¾‹å¦‚éŸ“å¼è¾£é†¬ç¾©å¤§åˆ©éºµã€æ³¡èœèµ·å¸æ¼¢å ¡ç­‰ã€‚</p>
                            <p>å°æ–¼é¤å»³ç¶“ç‡Ÿè€…è€Œè¨€ï¼Œä½¿ç”¨ç¾æˆçš„ç™¼é…µé†¬æ–™å¯ä»¥å¤§å¹…ç¸®çŸ­å‚™æ–™æ™‚é–“ã€‚å‚³çµ±é†ƒè£½éç¨‹å¾€å¾€éœ€è¦æ•¸å¤©ç”šè‡³æ•¸é€±ï¼Œè€Œä½¿ç”¨å°ˆæ¥­çš„ç™¼é…µé†¬æ–™ï¼Œåªéœ€é†ƒè£½æ•¸å°æ™‚å³å¯é”åˆ°ç›¸åŒçš„é¢¨å‘³æ·±åº¦ã€‚</p>
                            <h3>æˆæœ¬æ•ˆç›Šåˆ†æ</h3>
                            <p>æˆ‘å€‘å¯¦æ¸¬ç™¼ç¾ï¼Œä½¿ç”¨åº·å¯¶éŸ“å¼è¾£é†¬å–ä»£å‚³çµ±æ‰‹å·¥èª¿è£½çš„é†ƒæ–™ï¼Œå¯ä»¥ç¯€çœç´„ 30% çš„é£Ÿææˆæœ¬ï¼Œæ›´é‡è¦çš„æ˜¯ç¯€çœäº† 50% çš„äººåŠ›å·¥æ™‚ã€‚é€™åœ¨ç¼ºå·¥åš´é‡çš„ç•¶ä¸‹ï¼Œæ˜¯æ¥µå…·å¸å¼•åŠ›çš„è§£æ±ºæ–¹æ¡ˆã€‚</p>
                            <p>æ­¤å¤–ï¼Œç™¼é…µé£Ÿå“çš„å¥åº·å½¢è±¡ä¹Ÿç¬¦åˆç¾ä»£æ¶ˆè²»è€…å°é£²é£Ÿçš„è¿½æ±‚ã€‚å¯Œå«ç›Šç”ŸèŒçš„å½¢è±¡ï¼Œè®“èœå–®è¨­è¨ˆä¸Šæ›´æœ‰è¡ŒéŠ·è³£é»ã€‚</p>
                            <br><br><p>ç¸½çµä¾†èªªï¼Œå¼•å…¥éŸ“å¼ç™¼é…µé†¬ä¸åƒ…æ˜¯å£å‘³ä¸Šçš„å‰µæ–°ï¼Œæ›´æ˜¯ç¶“ç‡Ÿæ•ˆç‡çš„æå‡ã€‚</p>` },
                { id: 102, title: "é›ç²‰å–ä»£é«˜æ¹¯æˆæœ¬è¡“", category: "manage", date: "1æœˆ08æ—¥", isNew: true, img: "https://placehold.co/800x600/333/fff?text=Chicken+Powder",
                  views: "3.5k", ranking: 2, tldr: ["å‚³çµ±ç†¬æ¹¯è²»æ™‚","é›ç²‰å³æ²–å³ç”¨"], content: "å¯¦æ¸¬é¡¯ç¤º..." }
            ],
            products: [ 
                {name: "åº·å¯¶é®®é›æ±", img: "https://placehold.co/100/FFD700/333?text=Chicken"}, 
                {name: "åº·å¯¶éº»è¾£é†¬", img: "https://placehold.co/100/FF5700/FFF?text=Spicy"}, 
                {name: "åº·å¯¶æ‰“æ‹‹é†¬", img: "https://placehold.co/100/00652B/FFF?text=Thai"} 
            ],
            sop: { id:999, title:"3æ­¥é©Ÿå‡ºé¤ SOP", desc:"é‡å°ç¹å¿™å»šæˆ¿è¨­è¨ˆã€‚", steps:[{title:"å…èª¿å‘³",text:"ä½¿ç”¨å°ˆæ¥­é†¬æ–™"},{title:"é è£½",text:"çµ±ä¸€è¦æ ¼"},{title:"å¿«ç‚’",text:"å¤§ç«å‡ºé¤"}] },
            chef: { name:"æ±ŸæŒ¯èª ", desc:"ç±³å…¶æ—äºŒæ˜Ÿä¸»å»šï¼Œæ“…é•·é‹ç”¨åœ¨åœ°é£Ÿæï¼Œå°‡å‚³çµ±å·èœèˆ‡ç¾ä»£æŠ€æ³•çµåˆã€‚", img:"https://placehold.co/800x400/333/FFF?text=Chef+Andre" }
        };

        // --- Core Router ---
        function router(page) {
            document.querySelectorAll('.nav-item').forEach((el,i)=>el.classList.toggle('active', i===['home','info','scan','recipes','shop'].indexOf(page)));
            const root = document.getElementById('app-root');
            window.scrollTo(0,0);
            if(page==='home') root.innerHTML = renderHeader(page)+renderHome();
            else if(page==='info') root.innerHTML = renderHeader(page)+renderInfo();
            else if(page==='recipes') root.innerHTML = renderHeader(page)+renderRecipes();
            else if(page==='scan') renderScanPage();
            else if(page==='shop') root.innerHTML = renderHeader(page)+renderShop();
            else if(page==='profile') root.innerHTML = renderHeader(page)+renderProfile(); // New Route
        }

        function renderHeader(page) {
            // Updated Top Nav with Profile Icon
            let tabs = page==='home'? '' :
                       page==='info'?renderTabs(['æœ€æ–°æƒ…å ±','ç¶“ç‡Ÿç®¡ç†','é¤é£²è¶¨å‹¢'],'info'):'';
            const profileIcon = `<span class="material-symbols-outlined icon-btn" onclick="router('profile')">person</span>`;
            
            // Hide search/profile on Profile page for cleaner look, or keep them. keeping consistent.
            return `<header><div class="header-top"><div class="search-bar"><span class="material-symbols-outlined">search</span>æœå°‹...</div><span class="material-symbols-outlined icon-btn">notifications</span>${profileIcon}</div>${tabs}</header>`;
        }
        function renderTabs(l,c) { return `<div class="tab-bar"><div class="scrolling-wrapper">${l.map((t,i)=>`<div class="tab-chip ${i===0?'active':''}" onclick="filterList(this,'${t}','${c}')">${t}</div>`).join('')}</div></div>`; }

        // --- Pages ---
        function renderHome() {
            return `
            <div class="fade-in">
                <div style="padding:24px 16px 0;"><div style="font-size:12px;color:var(--primary);font-weight:700;">ğŸ‘‹ æ—©å®‰ï¼Œå¼µä¸»å»š</div><div style="font-size:22px;font-weight:800;color:#333;">ç‚ºä½ æ¨è–¦ï¼šæ‡¶äººé£Ÿè­œ</div></div>
                <div class="section-header"><div class="section-title"><span class="material-symbols-outlined" style="color:var(--secondary)">new_releases</span> 1æœˆæ–°èœä¸Šæ¶</div></div>
                <div class="card-scroll-container">${db.recipes.filter(r=>r.date.includes('1æœˆ')).map(r=>renderCardV(r,true)).join('')}</div>
                <div class="section-header"><div class="section-title"><span class="material-symbols-outlined" style="color:#FFD700">emoji_events</span> ç†±é–€æ’è¡Œ</div></div>
                <div style="margin:0 16px;"><div class="ranking-tabs"><div class="ranking-tab active" onclick="switchRanking(this,'recipe')">å°ˆæ¥­é£Ÿè­œ</div><div class="ranking-tab" onclick="switchRanking(this,'info')">é¤é£²æƒ…å ±</div></div><div id="ranking-list">${renderRanking('recipe')}</div></div>
                <div style="padding:24px 16px;"><div onclick="openSOP()" style="background:linear-gradient(135deg,#6A1B9A,#4A148C);border-radius:16px;padding:24px;color:white;display:flex;align-items:center;gap:16px;box-shadow:var(--shadow-md);cursor:pointer;"><span class="material-symbols-outlined" style="font-size:32px;">bolt</span><div><div style="font-weight:700;font-size:16px;">3æ­¥é©Ÿå‡ºé¤ SOP</div><div style="font-size:12px;opacity:0.8;">åˆé¤é«˜å³°æ•‘æ˜Ÿ</div></div></div></div>
                <div class="section-header"><div class="section-title">ç²¾é¸æ¨è–¦</div></div><div id="home-list" class="card-scroll-container">${db.recipes.map(r=>renderCardV(r)).join('')}</div>
            </div>`;
        }
        function renderRecipes() {
            return `
                <div class="chef-banner fade-in" onclick="openChef()"><div style="z-index:1;"><div>ç±³å…¶æ—ä¸»å»š</div><div style="font-size:20px;font-weight:800;margin-top:4px;">æ±ŸæŒ¯èª  ç¨å®¶æˆæ¬Š</div></div><span class="material-symbols-outlined" style="font-size:48px;">restaurant_menu</span></div>
                <div class="strategy-cta-grid fade-in"><div class="strategy-btn btn-change" onclick="startWizard('change')"><div class="btn-icon-circle"><span class="material-symbols-outlined">restaurant_menu</span></div><span class="strategy-label">æˆ‘è¦æ›èœ</span><span class="strategy-sub">å­£ç¯€/ç¯€æ…¶</span></div><div class="strategy-btn btn-fast" onclick="startWizard('fast')"><div class="btn-icon-circle"><span class="material-symbols-outlined">timer</span></div><span class="strategy-label">å¿«é€Ÿå‡ºé¤</span><span class="strategy-sub">æ•ˆç‡/SOP</span></div></div>
                ${renderTabs(['å…¨éƒ¨','åå»šå°ˆå€','æ‡¶äººåŒ…','ä½æˆæœ¬'],'recipes')}
                <div id="recipe-list" class="recipe-grid fade-in">${db.recipes.map(r=>renderCardV(r)).join('')}</div>
            `;
        }
        function renderInfo() { return `<div id="info-list" class="fade-in" style="padding-top:16px;">${db.info.map(i=>renderListCard(i)).join('')}</div>`; }
        
        // Task 4: Profile Page
        function renderProfile() {
            return `
            <div class="fade-in">
                <div class="profile-header">
                    <div class="profile-user">
                        <div class="profile-avatar">å¼µ</div>
                        <div>
                            <div style="font-size:20px;font-weight:700;">å¼µå¤§å»š</div>
                            <div style="font-size:14px;opacity:0.8;">é‡‘ç‰Œæœƒå“¡</div>
                        </div>
                    </div>
                </div>
                <div class="profile-card">
                    <div class="barcode-area">
                        <div style="font-size:12px;color:#888;margin-bottom:8px;">æœƒå“¡æ¢ç¢¼</div>
                        <img class="barcode-img" src="https://bwipjs-api.metafloor.com/?bcid=code128&text=123456789&height=10&scale=2&includetext" alt="barcode">
                    </div>
                    <div class="menu-grid">
                        <div class="menu-btn"><div class="menu-btn-icon"><span class="material-symbols-outlined">confirmation_number</span></div><div>ç¥¨åˆ¸å¤¾</div></div>
                        <div class="menu-btn"><div class="menu-btn-icon"><span class="material-symbols-outlined">favorite</span></div><div>æˆ‘çš„èœå–®</div></div>
                    </div>
                </div>
                <div class="support-btn" onclick="alert('é–‹å•Ÿç·šä¸Šå®¢æœè¦–çª—')">
                    <span class="material-symbols-outlined">support_agent</span> è¯ç¹«ç·šä¸Šå®¢æœ
                </div>
            </div>`;
        }

        function renderScanPage() {
            document.getElementById('app-root').innerHTML = `
                <div class="scan-container fade-in">
                    <div class="scan-controls"><div class="toggle-btn" onclick="this.querySelector('.toggle-switch').classList.toggle('on')">é€£çºŒæƒææ¨¡å¼ <div class="toggle-switch"></div></div></div>
                    <div class="scan-viewfinder"><div class="scan-frame"></div><div class="toast" id="scan-toast"><span class="material-symbols-outlined">check_circle</span> æƒææˆåŠŸ +50é»</div><button onclick="simulateScan()" style="position:absolute;bottom:40px;background:rgba(255,255,255,0.2);color:white;border:1px solid rgba(255,255,255,0.5);padding:8px 16px;border-radius:20px;cursor:pointer;">æ¨¡æ“¬æƒæ</button></div>
                    <div class="rewards-panel"><div class="progress-header"><span class="points-text">ç›®å‰: 850é»</span><span class="goal-text">å·® 150 é»æ› $100</span></div><div class="progress-track"><div class="progress-fill"></div></div><div style="font-size:14px;font-weight:700;margin-bottom:12px;">å¿«é€Ÿå…Œæ› (v19)</div><div class="instant-rewards"><div class="reward-card">ğŸª 7-11</div><div class="reward-card">ğŸ’¬ Line Pts</div></div></div>
                </div>`;
        }
        function renderShop() { return `<div style="text-align:center;padding:60px;color:#999;">å•†åŸè¼‰å…¥ä¸­...</div>`; }

        // --- Interaction ---
        function filterList(el, filter, ctx) {
            el.parentElement.querySelectorAll('.tab-chip').forEach(c=>c.classList.remove('active')); el.classList.add('active');
            if(ctx==='recipes') {
                const k = {'å…¨éƒ¨':'all','åå»šå°ˆå€':'chef','æ‡¶äººåŒ…':'lazy','ä½æˆæœ¬':'low_cost'}[filter];
                document.getElementById('recipe-list').innerHTML = db.recipes.filter(r=>k==='all'||r.category.includes(k)).map(r=>renderCardV(r)).join('');
            } else if(ctx==='info') {
                const k = {'æœ€æ–°æƒ…å ±':'all','ç¶“ç‡Ÿç®¡ç†':'manage','é¤é£²è¶¨å‹¢':'trend'}[filter];
                document.getElementById('info-list').innerHTML = db.info.filter(i=>k==='all'||i.category===k).map(i=>renderListCard(i)).join('');
            } 
        }
        function switchRanking(el, type) {
            el.parentElement.querySelectorAll('.ranking-tab').forEach(c=>c.classList.remove('active')); el.classList.add('active');
            document.getElementById('ranking-list').innerHTML = renderRanking(type);
        }
        function simulateScan() { document.getElementById('scan-toast').classList.add('show'); setTimeout(()=>document.getElementById('scan-toast').classList.remove('show'),2000); }

        // --- Renderers ---
        function renderCardV(r, badgeDate=false) {
            return `<div class="card" onclick="openDetail('recipe',${r.id})"><div class="card-img-wrapper"><div class="card-badge" style="${badgeDate?'background:var(--secondary)':''}">${badgeDate?r.date:r.type}</div><img class="card-img" src="${r.img}"></div><div class="card-content"><div class="card-title">${r.title}</div><div class="card-meta"><span class="meta-tag">ğŸ’° ${r.stats.cost}</span><span class="meta-tag">â± ${r.stats.time}</span><span class="meta-tag">ğŸ”¥ ${r.stats.diff}</span></div></div></div>`;
        }
        function renderListCard(i, rank) {
            return `<div class="list-card" onclick="openDetail('info',${i.id})">${rank?`<div class="rank-badge rank-${rank}">${rank}</div>`:''}<div style="flex:1;"><div style="font-size:12px;color:var(--primary);font-weight:700;">#${i.category.toUpperCase()} ${i.isNew?'<span style="color:red;">â— æ–°ä¸Šæ¶</span>':''}</div><div style="font-weight:700;margin-top:4px;">${i.title}</div><div style="font-size:12px;color:#888;">${i.views} é–±è®€</div></div><img class="list-card-img" src="${i.img}"></div>`;
        }
        function renderRanking(type) {
            const list = type==='recipe' ? db.recipes.slice(0,3) : db.info.slice(0,3);
            if(type==='recipe') return list.map((r,i)=>`<div class="list-card" onclick="openDetail('recipe',${r.id})"><div class="rank-badge rank-${i+1}">${i+1}</div><div style="flex:1;margin-left:8px;"><div style="font-weight:700;">${r.title}</div><div style="font-size:12px;color:#666;">${r.desc}</div></div><img class="list-card-img" src="${r.img}"></div>`).join('');
            return list.map((i,idx)=>renderListCard(i,idx+1)).join('');
        }

        // --- Task 1: Optimized Wizard Logic based on Flowchart ---
        let wizardState = { type: null, step: 0, selections: [], path: null };
        
        function startWizard(type) { 
            wizardState = { type, step: 0, selections: [], path: null }; 
            document.getElementById('wizard-title').innerText = type === 'change' ? "æˆ‘è¦æ›èœ" : "å¿«é€Ÿå‡ºé¤";
            renderWizardStep(); 
            document.getElementById('wizard-content').style.display = 'block'; 
            document.getElementById('wizard-loading').style.display = 'none'; 
            document.getElementById('wizard-overlay').style.display = 'flex'; 
        }

        function renderWizardStep() {
            let q = "", o = [];
            
            // Logic based on Flowchart
            if (wizardState.type === 'change') {
                if (wizardState.step === 0) {
                    q = "è«‹å•æ‚¨æƒ³ä¸»æ‰“ä»€éº¼ï¼Ÿ";
                    o = ["å­£ç¯€é™å®š", "ç¯€æ…¶ç‰¹é¤"];
                } else if (wizardState.step === 1) {
                    if (wizardState.selections[0] === "å­£ç¯€é™å®š") {
                        q = "é¸æ“‡æœˆä»½";
                        o = ["1~3æœˆ (æ˜¥)", "4~6æœˆ (å¤)", "7~9æœˆ (ç§‹)", "10~12æœˆ (å†¬)"];
                    } else {
                        q = "é¸æ“‡ç¯€æ…¶";
                        o = ["éå¹´", "æ¯è¦ªç¯€", "ç«¯åˆç¯€", "ä¸­ç§‹ç¯€"];
                    }
                } else if (wizardState.step === 2) {
                    q = "é¸æ“‡æ ¸å¿ƒé£Ÿæ";
                    o = ["é›è‚‰", "è±¬è‚‰", "ç‰›è‚‰", "æµ·é®®"];
                } else if (wizardState.step === 3) {
                    q = "é¸æ“‡èœç³»é¢¨æ ¼";
                    o = ["ä¸­å¼", "è¥¿å¼", "æ—¥å¼", "æ³°å¼"];
                }
            } else {
                // Fast Prep Flow
                if (wizardState.step === 0) {
                    q = "ç›®æ¨™å‡ºé¤æ™‚é–“";
                    o = ["3 åˆ†é˜å…§", "5 åˆ†é˜å…§", "10 åˆ†é˜å…§"];
                } else if (wizardState.step === 1) {
                    q = "ç¾æœ‰çƒ¹èª¿è¨­å‚™";
                    o = ["å¿«é€Ÿçˆ", "è’¸çƒ¤ç®±", "æ²¹ç‚¸é‹"];
                }
            }

            document.getElementById('wizard-content').innerHTML = `
                <div style="text-align:center;">
                    <div style="font-size:20px;font-weight:700;margin-bottom:24px;">${q}</div>
                    <div class="wizard-option-grid">${o.map(opt => `<div class="wizard-option" onclick="handleOptionClick('${opt}')">${opt}</div>`).join('')}</div>
                </div>`; 
            
            // Calculate total steps based on current path
            let totalSteps = wizardState.type === 'change' ? 4 : 2;
            document.getElementById('wizard-progress').innerHTML = Array(totalSteps).fill(0).map((_,i)=>`<div class="progress-bar ${i<=wizardState.step?'active':''}"></div>`).join('');
        }

        function handleOptionClick(sel) { 
            wizardState.selections.push(sel); 
            let totalSteps = wizardState.type === 'change' ? 4 : 2;
            
            if (wizardState.step < totalSteps - 1) { 
                wizardState.step++; 
                renderWizardStep(); 
            } else { 
                document.getElementById('wizard-content').style.display = 'none'; 
                document.getElementById('wizard-loading').style.display = 'block'; 
                setTimeout(() => { closeWizard(); renderRecommendationResults(wizardState.selections); }, 1500); 
            } 
        }

        function closeWizard() { document.getElementById('wizard-overlay').style.display = 'none'; }

        function renderRecommendationResults(tags) {
            document.getElementById('app-root').innerHTML = `
                <header><div class="header-top"><span class="material-symbols-outlined icon-btn" onclick="router('recipes')">arrow_back</span><div style="flex:1;text-align:center;color:white;font-weight:700;">æ¨è–¦çµæœ</div><span style="width:24px;"></span></div></header>
                <div class="result-context fade-in"><div class="result-context-title"><span class="material-symbols-outlined" style="font-size:18px;">auto_awesome</span> ç‚ºæ‚¨æ¨è–¦ 10 é“æœ€ä½³æ–¹æ¡ˆ</div><div class="result-chips">${tags.map(t => `<div class="result-chip">${t}</div>`).join('')}</div></div>
                <div class="recipe-grid fade-in" style="padding-top:0;">${db.recipes.map(r => renderCardV(r)).join('')}</div>`;
            window.scrollTo(0,0);
        }

        // --- Detail View Logic ---
        let currentRecipe = null;
        let currentPortion = 0;
        let editingCommentIndex = -1;

        function openDetail(type, id) {
            const footerSlot = document.getElementById('detail-footer-slot');
            document.getElementById('detail-view').style.display = 'block';
            document.body.style.overflow = 'hidden';

            if(type==='recipe') {
                currentRecipe = db.recipes.find(x=>x.id===id) || db.recipes[0];
                window.currentRecipeId = id;
                currentPortion = currentRecipe.baseServings || 10;
                
                renderRecipeDetail(currentRecipe);
                
                footerSlot.innerHTML = `
                    <div class="detail-footer fade-in">
                        <button class="btn-outline" onclick="addToMenu()"><span class="material-symbols-outlined">post_add</span> åŠ å…¥èœå–®</button>
                        <button class="btn-primary" onclick="goToProduct()"><span class="material-symbols-outlined">shopping_cart_checkout</span> é ˜è©¦ç”¨åŒ…</button>
                    </div>`;
            } else {
                renderInfoDetail(db.info.find(x=>x.id===id));
                footerSlot.innerHTML = '';
            }
        }

        function renderRecipeDetail(r) {
            document.getElementById('detail-img').src = r.img;
            const ingHtml = generateIngredientList(r.ingredients, r.baseServings || 10, currentPortion);

            const html = `
                <div style="font-size:24px;font-weight:700;">${r.title}</div>
                <div class="tag-row">${r.tags ? r.tags.map(t=>`<span class="detail-tag">${t}</span>`).join('') : ''}</div>
                <div class="info-grid"><div class="info-box"><div class="info-label">æˆæœ¬</div><div class="info-value">${r.stats.cost}</div></div><div class="info-box"><div class="info-label">æ™‚é–“</div><div class="info-value">${r.stats.time}</div></div><div class="info-box"><div class="info-label">é›£åº¦</div><div class="info-value">${r.stats.diff}</div></div></div>
                
                <h3 class="section-header-detail">æ‰€éœ€ææ–™ <span style="font-size:12px;color:#888;font-weight:400;margin-left:auto;">å¯ä¾äººæ•¸èª¿æ•´</span></h3>
                
                <div class="portion-control">
                    <div class="portion-btn" onclick="updatePortion(-1)">-</div>
                    <div class="portion-display">
                        <span id="portion-val">${currentPortion}</span>
                        <span class="portion-label">äººä»½</span>
                    </div>
                    <div class="portion-btn" onclick="updatePortion(1)">+</div>
                </div>

                <div class="ing-group" id="ing-list">${ingHtml}</div>
                
                <h3 class="section-header-detail">çƒ¹èª¿æ­¥é©Ÿ</h3>
                ${r.steps && r.steps.length > 0 ? r.steps.map((s,i)=>`<div class="step-row" style="margin-bottom:16px;display:flex;gap:12px;"><div class="step-idx" style="background:var(--primary);color:white;width:24px;height:24px;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:12px;flex-shrink:0;">${i+1}</div><div style="flex:1;"><div style="font-weight:700;margin-bottom:4px;">${s.t}</div><div style="color:#555;">${s.c}</div></div></div>`).join('') : '<div style="color:#999;">æš«ç„¡æ­¥é©Ÿ</div>'}
                
                <div style="background:#FFF3E0;padding:16px;border-radius:12px;margin:16px 0;display:flex;gap:12px;align-items:start;"><span class="material-symbols-outlined" style="color:#E65100">lightbulb</span> <div><strong>ä¸»å»š Tipsï¼š</strong> ${r.tips || "ç„¡"}</div></div>

                ${r.multiUse && r.multiUse.length > 0 ?`<h3 class="section-header-detail">ä¸€é†¬å¤šç”¨</h3><div class="card-scroll-container">${r.multiUse.map(m=>`
                    <div class="rp-card" onclick="openDetail('recipe', ${m.id})">
                        <img class="rp-img" src="${m.img}">
                        <div style="font-weight:700;font-size:13px;">${m.name}</div>
                        <div style="color:var(--secondary);font-weight:700;font-size:12px;">${m.cost}</div>
                    </div>`).join('')}</div>`:''}

                <div class="comment-section">
                    <div class="section-title" style="padding-left:0;">ä¸»å»šè©•è«–å€</div>
                    <div id="comments-container">${renderComments(r.comments)}</div>
                    <div class="comment-input-area">
                        <input type="text" id="comment-input" class="comment-input" style="width:100%;border:none;background:transparent;outline:none;font-size:14px;" placeholder="åˆ†äº«æ‚¨çš„è©¦åšå¿ƒå¾—...">
                        <button class="btn-submit" id="btn-comment-submit" onclick="submitComment()"><span class="material-symbols-outlined" style="font-size:18px;">send</span></button>
                    </div>
                </div>

                <h3 class="section-header-detail">æ¨è–¦å•†å“</h3>
                <div class="product-rec-container">
                    ${db.products.map(p=>`
                        <div class="product-card-sm">
                            <img src="${p.img}">
                            <div style="font-weight:700;font-size:14px;">${p.name}</div>
                            <span class="material-symbols-outlined" style="margin-left:auto;color:#ccc;">chevron_right</span>
                        </div>
                    `).join('')}
                </div>`;
            document.getElementById('detail-content').innerHTML = html;
        }

        function renderInfoDetail(i) {
            document.getElementById('detail-img').src = i.img;
            document.getElementById('detail-content').innerHTML = `<div style="font-size:22px;font-weight:700;margin-bottom:12px;">${i.title}</div><div style="line-height:1.8;">${i.content}</div>`;
        }

        // --- Logic: Ingredient Scaling ---
        function updatePortion(delta) {
            const newP = currentPortion + delta;
            if(newP < 1) return;
            currentPortion = newP;
            document.getElementById('portion-val').innerText = currentPortion;
            document.getElementById('ing-list').innerHTML = generateIngredientList(currentRecipe.ingredients, currentRecipe.baseServings || 10, currentPortion, true);
        }

        function generateIngredientList(ingredients, baseP, currP, animate=false) {
            if (!ingredients || ingredients.length === 0) return '<div style="color:#999;">æš«ç„¡é£Ÿæè³‡è¨Š</div>';
            return ingredients.map(ing => {
                const newAmount = Math.round((ing.amount / baseP) * currP * 10) / 10;
                return `
                <div class="checkbox-item" onclick="this.querySelector('.checkbox-circle').classList.toggle('checked')">
                    <div class="checkbox-left">
                        <div class="checkbox-circle"></div>
                        <span>${ing.name}</span>
                    </div>
                    <div class="ing-amount ${animate?'changed':''}">${newAmount} ${ing.unit}</div>
                </div>`;
            }).join('');
        }

        // --- Logic: Comments ---
        function renderComments(comments) {
            if(!comments||!comments.length) return '<div style="color:#999;font-size:13px;">å°šç„¡è©•è«–ã€‚</div>';
            return comments.map((c,i) => `
                <div class="comment-item">
                    <div class="comment-avatar">${c.user[0]}</div>
                    <div class="comment-body">
                        <div class="comment-name">${c.user}</div>
                        <div class="comment-meta"><span class="comment-stars">${'â˜…'.repeat(c.star)}</span> <span>${c.date}</span></div>
                        <div class="comment-text">${c.text}</div>
                        <div class="comment-actions">
                            ${c.user==='æˆ‘'?`
                                <div class="action-chip" onclick="editComment(${i})"><span class="material-symbols-outlined" style="font-size:14px;">edit</span> ç·¨è¼¯</div>
                                <div class="action-chip" onclick="delCom(${i})"><span class="material-symbols-outlined" style="font-size:14px;">delete</span> åˆªé™¤</div>
                            `:`<div class="action-chip"><span class="material-symbols-outlined" style="font-size:14px;">thumb_up</span> æœ‰å¹«åŠ©</div>`}
                        </div>
                    </div>
                </div>`).join('');
        }

        function submitComment() {
            const input = document.getElementById('comment-input');
            const txt = input.value.trim();
            if(!txt) return;

            const r = db.recipes.find(x=>x.id===window.currentRecipeId);
            
            if(editingCommentIndex > -1) {
                r.comments[editingCommentIndex].text = txt;
                r.comments[editingCommentIndex].date = "å·²ç·¨è¼¯";
                editingCommentIndex = -1;
                document.getElementById('btn-comment-submit').classList.remove('editing');
                document.getElementById('btn-comment-submit').innerHTML = '<span class="material-symbols-outlined" style="font-size:18px;">send</span>';
            } else {
                r.comments.unshift({user:"æˆ‘",star:5,text:txt,date:"å‰›å‰›"});
            }
            input.value = '';
            document.getElementById('comments-container').innerHTML = renderComments(r.comments);
        }

        function editComment(idx) {
            const r = db.recipes.find(x=>x.id===window.currentRecipeId);
            const comment = r.comments[idx];
            document.getElementById('comment-input').value = comment.text;
            document.getElementById('comment-input').focus();
            editingCommentIndex = idx;
            const btn = document.getElementById('btn-comment-submit');
            btn.classList.add('editing');
            btn.innerHTML = '<span class="material-symbols-outlined" style="font-size:18px;">check</span>';
        }

        function delCom(i) { 
            if(confirm('ç¢ºå®šè¦åˆªé™¤ç•™è¨€ï¼Ÿ')) {
                const r=db.recipes.find(x=>x.id===window.currentRecipeId); 
                r.comments.splice(i,1); 
                document.getElementById('comments-container').innerHTML=renderComments(r.comments); 
                if(i === editingCommentIndex) {
                    editingCommentIndex = -1;
                    document.getElementById('comment-input').value = '';
                    document.getElementById('btn-comment-submit').classList.remove('editing');
                }
            }
        }

        // --- Standard Logic ---
        function addToMenu() { alert('å·²åŠ å…¥èœå–®ï¼'); }
        function goToProduct() { alert('å‰å¾€ç›¸é—œå•†å“é é¢...'); }

        function openSOP() {
            const s = db.sop;
            document.getElementById('detail-img').src = s.img;
            document.getElementById('detail-content').innerHTML = `<div style="font-size:24px;font-weight:700;">${s.title}</div><div style="background:#F3E5F5;padding:16px;border-radius:12px;margin:16px 0;color:#4A148C;">${s.desc}</div>${s.steps.map((st,i)=>`<div style="margin-bottom:16px;"><div style="font-weight:700;">${i+1}. ${st.title}</div><div style="font-size:13px;color:#666;">${st.text}</div></div>`).join('')}`;
            document.getElementById('detail-footer-slot').innerHTML = ''; 
            document.getElementById('detail-view').style.display='block';
        }

        function openChef() {
            const c = db.chef;
            document.getElementById('detail-img').src = c.img;
            // Filter all chef recipes
            const chefRecipes = db.recipes.filter(r => r.type === 'åå»š');
            document.getElementById('detail-content').innerHTML = `
                <div style="font-size:24px;font-weight:700;">${c.name}</div>
                <div style="margin-top:16px;color:#555;">${c.desc}</div>
                <h3 class="section-header-detail">ä¸»å»šæ¨è–¦é£Ÿè­œ (${chefRecipes.length})</h3>
                <div class="recipe-grid" style="padding:0;">${chefRecipes.map(r=>renderCardV(r)).join('')}</div>`;
            document.getElementById('detail-footer-slot').innerHTML = ''; 
            document.getElementById('detail-view').style.display='block';
        }

        function closeDetail() { document.getElementById('detail-view').style.display = 'none'; document.body.style.overflow = 'auto'; }
        function updateProgress() { const el = document.getElementById('detail-view'); document.getElementById('read-progress').style.width = (el.scrollTop / (el.scrollHeight - el.clientHeight)) * 100 + '%'; }

        router('home');
    </script>
</body>
</html>